---
import { contact } from "../data/contact";
import { services } from "../data/services";
---
<section id="contact" class="py-20 bg-gray-50">
    <div class="max-w-7xl mx-auto px-6">
        <div class="text-center mb-16">
            <h2 class="text-4xl font-bold text-gray-900 mb-4">
                Let us know what you need
            </h2>
            <p class="text-xl text-gray-600">
                Ready to experience professional cleaning services? Contact us
                for a customized quote.
            </p>
        </div>
        <div class="grid lg:grid-cols-2 gap-12">
            <!-- Contact Information -->
            <div>
                <h3 class="text-2xl font-semibold text-gray-900 mb-8">
                    Contact Information
                </h3>
                <div class="space-y-6 mb-8">
                    <div class="flex items-start space-x-4">
                        <div
                            class="w-12 h-12 flex items-center justify-center bg-primary/10 rounded-lg"
                        >
                            <i class="ri-phone-line text-xl text-primary"></i>
                        </div>
                        <div>
                            <div class="font-semibold text-gray-900">Phone</div>
                            <div class="text-gray-600">{contact.phone}</div>
                            <div class="text-sm text-gray-500">
                                Available 24/7 for emergencies
                            </div>
                        </div>
                    </div>
                    <div class="flex items-start space-x-4">
                        <div
                            class="w-12 h-12 flex items-center justify-center bg-primary/10 rounded-lg"
                        >
                            <i class="ri-mail-line text-xl text-primary"></i>
                        </div>
                        <div>
                            <div class="font-semibold text-gray-900">Email</div>
                            <div class="text-gray-600">
                                {contact.email}
                            </div>
                            <div class="text-sm text-gray-500">
                                Response within 2 hours
                            </div>
                        </div>
                    </div>
                    <div class="flex items-start space-x-4">
                        <div
                            class="w-12 h-12 flex items-center justify-center bg-primary/10 rounded-lg"
                        >
                            <i class="ri-map-pin-line text-xl text-primary"></i>
                        </div>
                        <div>
                            <div class="font-semibold text-gray-900">
                                Service Area
                            </div>
                            <div class="text-gray-600">
                                Orange County &amp; Surrounding Areas
                            </div>
                            <div class="text-sm text-gray-500">
                                50+ mile radius coverage
                            </div>
                        </div>
                    </div>
                    <div class="flex items-start space-x-4">
                        <div
                            class="w-12 h-12 flex items-center justify-center bg-primary/10 rounded-lg"
                        >
                            <i class="ri-time-line text-xl text-primary"></i>
                        </div>
                        <div>
                            <div class="font-semibold text-gray-900">
                                Business Hours
                            </div>
                            <div class="text-gray-600">
                                Monday - Friday: 7:00 AM - 8:00 PM
                            </div>
                            <div class="text-gray-600">
                                Saturday: 8:00 AM - 6:00 PM
                            </div>
                            <div class="text-gray-600">
                                Sunday: 9:00 AM - 5:00 PM
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Google Maps Embed -->
                <div class="w-full h-64 bg-gray-200 rounded-xl overflow-hidden">
                    <iframe
                        src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d39918.50239896984!2d-117.87957027492753!3d33.74185609290338!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e1!3m2!1sen!2sus!4v1761451153364!5m2!1sen!2sus"
                        width="100%"
                        height="100%"
                        style="border:0;"
                        allowfullscreen=""
                        loading="lazy"
                        referrerpolicy="no-referrer-when-downgrade"
                        title="Service Area Map"
                    ></iframe>
                </div>
            </div>
            <!-- Booking Form -->
            <div class="bg-white p-8 rounded-xl shadow-sm">
                <h3 class="text-2xl font-semibold text-gray-900 mb-6">
                    Get in touch
                </h3>
                <form class="space-y-6" action="https://formsubmit.co/c31bc10292606547aa823e1342fac6a2" method="POST" id="contact-form" novalidate>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-2"
                                for="first_name"
                                >First Name <span class="text-red-500">*</span></label
                            >
                            <input
                                type="text"
                                id="first_name"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm"
                                placeholder="John"
                                name="first_name"
                                required
                                minlength="2"
                                autocomplete="given-name"
                            />
                            <p class="text-red-500 text-xs mt-1 hidden" id="first_name-error">Please enter your first name (at least 2 characters)</p>
                        </div>
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-2"
                                for="last_name"
                                >Last Name <span class="text-red-500">*</span></label
                            >
                            <input
                                type="text"
                                id="last_name"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm"
                                placeholder="Smith"
                                name="last_name"
                                required
                                minlength="2"
                                autocomplete="family-name"
                            />
                            <p class="text-red-500 text-xs mt-1 hidden" id="last_name-error">Please enter your last name (at least 2 characters)</p>
                        </div>
                    </div>
                    <div>
                        <label
                            class="block text-sm font-medium text-gray-700 mb-2"
                            for="email"
                            >Email Address <span class="text-red-500">*</span></label
                        >
                        <input
                            type="email"
                            id="email"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm"
                            placeholder="john@example.com"
                            name="email"
                            autocomplete="email"
                        />
                    </div>
                    <div>
                        <label
                            class="block text-sm font-medium text-gray-700 mb-2"
                            for="phone"
                            >Phone Number <span class="text-red-500">*</span></label
                        >
                        <input
                            type="tel"
                            id="phone"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm"
                            placeholder="(555) 123-4567"
                            name="phone"
                            required
                            pattern="[\(\)\d\s\-\+\.ext]+"
                            autocomplete="tel"
                        />
                        <p class="text-red-500 text-xs mt-1 hidden" id="phone-error">Please enter a valid phone number</p>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-2"
                                >Service Type <span class="text-red-500">*</span></label
                            >
                            <div class="relative">
                                <button
                                    type="button"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm text-left bg-white flex items-center justify-between"
                                    onclick="toggleDropdown('service-dropdown')"
                                    id="service-button"
                                >
                                    <span id="service-selected"
                                        >Select Service</span
                                    >
                                    <input type="hidden" name="service_type" id="service-selected-input" required />
                                    <i class="ri-arrow-down-s-line"></i>
                                </button>
                                <div
                                    id="service-dropdown"
                                    class="hidden absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-lg mt-1 shadow-lg z-10"
                                >
                                    <div class="py-1">
                                        {services.map(service => {
                                            return (
                                                <button
                                                    type="button"
                                                    class="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm"
                                                    onclick=`selectOption('service', '${service.name}')`
                                                >
                                                    {service.name}
                                                </button>
                                            )
                                        })}
                                    </div>
                                </div>
                                <p class="text-red-500 text-xs mt-1 hidden" id="service_type-error">Please select a service type</p>
                            </div>
                        </div>
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-2"
                                >Property Type <span class="text-red-500">*</span></label
                            >
                            <div class="relative">
                                <button
                                    type="button"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm text-left bg-white flex items-center justify-between"
                                    onclick="toggleDropdown('property-dropdown')"
                                    id="property-button"
                                >
                                    <span id="property-selected"
                                        >Select Property</span
                                    >
                                    <input type="hidden" name="property_type" id="property-selected-input" required />
                                    <i class="ri-arrow-down-s-line"></i>
                                </button>
                                <div
                                    id="property-dropdown"
                                    class="hidden absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-lg mt-1 shadow-lg z-10"
                                >
                                    <div class="py-1">
                                        <button
                                            type="button"
                                            class="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm"
                                            onclick="selectOption('property', 'Residential Home')"
                                            >Residential Home</button
                                        >
                                        <button
                                            type="button"
                                            class="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm"
                                            onclick="selectOption('property', 'Office Building')"
                                            >Office Building</button
                                        >
                                        <button
                                            type="button"
                                            class="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm"
                                            onclick="selectOption('property', 'Retail Store')"
                                            >Retail Store</button
                                        >
                                        <button
                                            type="button"
                                            class="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm"
                                            onclick="selectOption('property', 'Medical Facility')"
                                            >Medical Facility</button
                                        >
                                    </div>
                                </div>
                                <p class="text-red-500 text-xs mt-1 hidden" id="property_type-error">Please select a property type</p>
                            </div>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-2"
                                for="preferred_date"
                                >Preferred Date <span class="text-red-500">*</span></label
                            >
                            <input
                                type="date"
                                id="preferred_date"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm"
                                name="preferred_date"
                                required
                            />
                            <p class="text-red-500 text-xs mt-1 hidden" id="preferred_date-error">Please select a preferred date</p>
                        </div>
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-2"
                                >Preferred Time <span class="text-red-500">*</span></label
                            >
                            <div class="relative">
                                <button
                                    type="button"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm text-left bg-white flex items-center justify-between"
                                    onclick="toggleDropdown('time-dropdown')"
                                    id="time-button"
                                >
                                    <span id="time-selected">Select Time</span>
                                    <input type="hidden" name="preferred_time" id="time-selected-input" required />
                                    <i class="ri-arrow-down-s-line"></i>
                                </button>
                                <div
                                    id="time-dropdown"
                                    class="hidden absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-lg mt-1 shadow-lg z-10"
                                >
                                    <div class="py-1">
                                        <button
                                            type="button"
                                            class="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm"
                                            onclick="selectOption('time', 'Morning (8AM-12PM)')"
                                            >Morning (8AM-12PM)</button
                                        >
                                        <button
                                            type="button"
                                            class="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm"
                                            onclick="selectOption('time', 'Afternoon (12PM-5PM)')"
                                            >Afternoon (12PM-5PM)</button
                                        >
                                        <button
                                            type="button"
                                            class="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm"
                                            onclick="selectOption('time', 'Evening (5PM-8PM)')"
                                            >Evening (5PM-8PM)</button
                                        >
                                    </div>
                                </div>
                                <p class="text-red-500 text-xs mt-1 hidden" id="preferred_time-error">Please select a preferred time</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label
                            class="block text-sm font-medium text-gray-700 mb-2"
                            >Additional Details</label
                        >
                        <textarea
                            rows="4"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm"
                            placeholder="Please describe your cleaning needs, square footage, special requirements, etc."
                            name="additional_details"
                        ></textarea>
                    </div>
                    <button
                        type="submit"
                        class="w-full cursor-pointer bg-primary text-white py-4 !rounded-button text-lg font-semibold hover:bg-primary/70 transition-colors whitespace-nowrap"
                    >
                        Get Quote
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>

<script id="dropdown-functionality">
    function toggleDropdown(dropdownId) {
        const dropdown = document.getElementById(dropdownId);
        const allDropdowns = document.querySelectorAll('[id$="-dropdown"]');
        allDropdowns.forEach((d) => {
            if (d.id !== dropdownId) {
                d.classList.add("hidden");
            }
        });
        dropdown.classList.toggle("hidden");
    }
    function selectOption(type, value) {
        const selectedElement = document.getElementById(type + "-selected");
        const dropdown = document.getElementById(type + "-dropdown");
        const input = document.getElementById(type + "-selected-input");
        if(input) {
            input.value = value;
            // Clear error when user selects an option
            clearError(input.name);
        }
        selectedElement.textContent = value;
        dropdown.classList.add("hidden");
    }
    document.addEventListener("click", function (event) {
        const dropdowns = document.querySelectorAll('[id$="-dropdown"]');
        const buttons = document.querySelectorAll(
            '[onclick^="toggleDropdown"]',
        );
        let isClickInsideDropdown = false;
        dropdowns.forEach((dropdown) => {
            if (dropdown.contains(event.target)) {
                isClickInsideDropdown = true;
            }
        });
        buttons.forEach((button) => {
            if (button.contains(event.target)) {
                isClickInsideDropdown = true;
            }
        });
        if (!isClickInsideDropdown) {
            dropdowns.forEach((dropdown) => {
                dropdown.classList.add("hidden");
            });
        }
    });
</script>

<script id="form-validation">
    // Validation helper functions
    function showError(fieldName, message) {
        const errorElement = document.getElementById(fieldName + '-error');
        const fieldElement = document.getElementById(fieldName) ||
                            document.getElementById(fieldName + '-button') ||
                            document.querySelector(`[name="${fieldName}"]`);

        if (errorElement) {
            errorElement.classList.remove('hidden');
            if (message) errorElement.textContent = message;
        }

        if (fieldElement) {
            fieldElement.classList.add('border-red-500');
            fieldElement.classList.remove('border-gray-300');
        }
    }

    function clearError(fieldName) {
        const errorElement = document.getElementById(fieldName + '-error');
        const fieldElement = document.getElementById(fieldName) ||
                            document.getElementById(fieldName + '-button') ||
                            document.querySelector(`[name="${fieldName}"]`);

        if (errorElement) {
            errorElement.classList.add('hidden');
        }

        if (fieldElement) {
            fieldElement.classList.remove('border-red-500');
            fieldElement.classList.add('border-gray-300');
        }
    }

    function validateField(field) {
        const fieldName = field.name || field.id;
        let isValid = true;

        // Clear previous error
        clearError(fieldName);

        // Check if field is required and empty
        if (field.hasAttribute('required') && !field.value.trim()) {
            showError(fieldName);
            isValid = false;
        }
        // Check minimum length
        else if (field.hasAttribute('minlength') && field.value.length < parseInt(field.getAttribute('minlength'))) {
            showError(fieldName);
            isValid = false;
        }
        // Check email format
        else if (field.type === 'email' && field.value) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(field.value)) {
                showError(fieldName, 'Please enter a valid email address');
                isValid = false;
            }
        }
        // Check phone pattern
        else if (field.type === 'tel' && field.value) {
            const phoneRegex = /[\(\)\d\s\-\+\.ext]+/;
            if (!phoneRegex.test(field.value) || field.value.replace(/\D/g, '').length < 10) {
                showError(fieldName, 'Please enter a valid phone number');
                isValid = false;
            }
        }
        // Check date is not in the past
        else if (field.type === 'date' && field.value) {
            const selectedDate = new Date(field.value);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            if (selectedDate < today) {
                showError(fieldName, 'Please select a date in the future');
                isValid = false;
            }
        }

        return isValid;
    }

    // Add real-time validation on blur
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('contact-form');
        if (!form) return;

        // Add blur event listeners to all form fields
        const formFields = form.querySelectorAll('input[required], textarea[required]');
        formFields.forEach(field => {
            field.addEventListener('blur', function() {
                validateField(this);
            });

            // Clear error on input
            field.addEventListener('input', function() {
                if (this.value.trim()) {
                    clearError(this.name || this.id);
                }
            });
        });

        // Form submission validation
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            let isFormValid = true;
            const requiredFields = form.querySelectorAll('[required]');

            // Validate all required fields
            requiredFields.forEach(field => {
                if (!validateField(field)) {
                    isFormValid = false;
                }
            });

            // Scroll to first error if form is invalid
            if (!isFormValid) {
                const firstError = form.querySelector('.border-red-500');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstError.focus();
                }
                return false;
            }

            // If valid, submit the form
            form.submit();
        });

        // Set minimum date to today for date picker
        const dateInput = document.getElementById('preferred_date');
        if (dateInput) {
            const today = new Date().toISOString().split('T')[0];
            dateInput.setAttribute('min', today);
        }
    });
</script>